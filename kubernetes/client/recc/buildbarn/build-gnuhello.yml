apiVersion: batch/v1
kind: Job
metadata:
  name: build-gnuhello
  namespace: buildbarn
spec:
  template:
    metadata:
      name: build-gnuhello
    spec:
      containers:
      - name: build-gnuhello
        image: remoteapistesting/recc-build:latest
        command: ["/bin/bash", "-x", "-c"]
        args:
          - apt update && apt install -y wget clang;
            wget https://ftp.gnu.org/gnu/hello/hello-2.10.tar.gz;
            tar xvf hello-2.10.tar.gz;
            cd hello-2.10;
            ./configure;
            mkdir -p recc;
            echo "remote_platform_container-image=docker://marketplace.gcr.io/google/rbe-ubuntu16-04@sha256:87e1bb4a47ade8ad4db467a2339bd0081fcf485ec02bcfc3b30309280b38d14b" > recc/recc.conf;
            export RECC_SERVER=frontend:8980;
            export RECC_INSTANCE=ubuntu16-04;
            export RECC_REMOTE_PLATFORM_OSFamily=Linux;
            time make CC="recc clang";
            ./hello
      restartPolicy: Never
  backoffLimit: 0
